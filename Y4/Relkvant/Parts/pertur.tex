\section{Perturbation Theory}

\paragraph{The $S$-Matrix}
Consider a set of particles moving from infinity to some point, where they all interact before being scattered and moving back to infinity. Denoting incoming states at infinity with in and outgoing states with out, we are interested in probability amplitudes of the form
\begin{align*}
	A = \braket{\vb{q}_{1}, \dots, \vb{q}_{m}, \text{out}}{\vb{p}_{1}, \dots, \vb{p}_{n}, \text{in}}.
\end{align*}
These are states of the real-world Hamiltonian, but the states at infinity should be similar to those of an interaction-free theory. Denoting states of the corresponding interaction-free theory without the text, we define the operator $S$, or the $S$-matrix, as
\begin{align*}
	\braket{\vb{q}_{1}, \dots, \vb{q}_{m}, \text{out}}{\vb{p}_{1}, \dots, \vb{p}_{n}, \text{in}} = \mel{\vb{q}_{1}, \dots, \vb{q}_{m}}{S}{\vb{p}_{1}, \dots, \vb{p}_{n}}.
\end{align*}

\paragraph{Asymptotic Fields}
Consider some theory described by
\begin{align*}
	\lag = \frac{1}{2}\left(\del{}{\mu}\phi\del{\mu}{}\phi - m^{2}\phi^{2}\right) + \lag_{\text{int}},
\end{align*}
where the interaction term contains no derivatives and we have used the so-called bare mass $m_{0}$. The equation of motion is
\begin{align*}
	(\dalem{} + m_{0}^{2})\phi = j(x),
\end{align*}
where $j(x)$ arises from the interaction term. We want to find a so-called asymptotic field $\phi_{\text{in}}$, which is a free Klein-Gordon field with mass $m$, that transforms the same as $\phi$ under the Poincare group. This field is then to be associated with the vacuum $\ket{0}$ of the free theory, which is distinct from the physical vacuum $\ket{\Omega}$ of the interacting theory.

The two fields can be related by adding a term $(m^{2} - m_{0}^{2})\phi$ to the equation of motion, which modifies the right-hand side to $\tilde{j}(x)$. We then find
\begin{align*}
	\sqrt{Z}\phi_{\text{in}} = \phi + \integ[4]{}{}{y}{\kgprop{R}{x - y, m}\tilde{j}(y)},
\end{align*}
where $Z$ is a normalization constant. We want $\tilde{j}$ to satisfy the strong asymptotic condition
\begin{align*}
	\lim\limits_{x^{0}\to -\inf}\phi(x) = \sqrt{Z}\phi_{\text{in}}(x).
\end{align*}
This would imply that when particles are at large separations, they do not interact. However, this assumption neglects self-interactions as well, and can therefore never truly hold. In fact, if it were to hold by assumption, the S matrix would be trivial. The claim of Lehmann, Symanzik and Zimmermann is that we can consider two normalizable states $\ket{\alpha}$ and $\ket{\beta}$ and introduce the functional
\begin{align*}
	\phi(t, f) = i\integ[3]{}{}{\vb{x}}{f\cc(t, \vb{x})\delsw{}{0}\phi(t, \vb{x})},\ a\delsw{}{}b = a\del{}{}b - (\del{}{}a)b,
\end{align*}
where $f$ is a normalizable Klein-Gordon field (a function, not an operator) with mass $m$, and thus acts as a test function in the Schwarz class. We then have the weak asymptotic condition
\begin{align*}
	\lim\limits_{x^{0} \to -\infty}\mel{\alpha}{\phi(t, f)}{\beta} = \sqrt{Z}\mel{\alpha}{\phi_{\text{in}}(t, f)}{\beta},
\end{align*}
which is more well-defined.

At this point we introduce another asymptotic free field $\phi_{\text{out}}$, which should satisfy the same conditions as $\phi_{\text{in}}$. We can expand $\phi_{\text{in}}$ in normal modes as
\begin{align*}
	\phi_{\text{in}} = \integ[3]{}{}{\vb{p}}{\frac{1}{p_{0}}(f_{p}(x)a_{\text{in}}(\vb{p}) + f_{p}\cc(x)a_{\text{in}}\adj(\vb{p}))},\ f_{p}(x) = \frac{1}{\sqrt{2(2\pi)^{3}}}e^{-ipx},
\end{align*}
with a similar expansion for $\phi_{\text{out}}$. This can somehow be inverted to
\begin{align*}
	a_{\text{in}}(\vb{p}) = i\integ[3]{}{}{\vb{x}}{f_{p}\cc(x)\delsw{}{0}\phi_{\text{in}}(x)}.
\end{align*}

\paragraph{The LSZ Formalism}
In the LSZ formalism we write the elements of the S-matrix as vacuum expectation values of products of the field operators.

\paragraph{The LSZ Formula for Klein-Gordon Fields}
To demonstrate it, consider a real scalar Klein-Gordon field $\phi$ and states $\ket{\alpha, \vb{p}_{n}, \text{in}}$ and $\ket{\beta, \text{out}}$, where $\alpha$ is a shorthand for a set of momenta $\vb{p}$ and $\beta$ similarly a shorthand for momenta $\vb{q}$. We then write
\begin{align*}
	\braket{\beta, \text{out}}{\alpha, \vb{p}_{n}, \text{in}} &= \mel{\beta, \text{out}}{a_{\text{in}}\adj(\vb{p_{n}})}{\alpha, \text{in}} \\
	&= \mel{\beta, \text{out}}{a_{\text{out}}\adj(\vb{p_{n}})}{\alpha, \text{in}} + \mel{\beta, \text{out}}{a_{\text{in}}\adj(\vb{p_{n}})}{\alpha, \text{in}} - \mel{\beta, \text{out}}{a_{\text{out}}\adj(\vb{p_{n}})}{\alpha, \text{in}} \\
	&= \braket{\beta, \hat{\vb{p}}_{n}, \text{out}}{\alpha, \text{in}} - i\mel{\beta, \text{out}}{\integ[3]{}{}{\vb{x}}{f_{p_{n}}\delsw{}{0}(\phi_{\text{in}}\adj - \phi_{\text{out}}\adj)}}{\alpha, \text{in}} \\
	&= \braket{\beta, \hat{\vb{p}}_{n}, \text{out}}{\alpha, \text{in}} - i\mel{\beta, \text{out}}{\integ[3]{}{}{\vb{x}}{f_{p_{n}}\delsw{}{0}(\phi_{\text{in}} - \phi_{\text{out}})}}{\alpha, \text{in}},
\end{align*}
assuming the asymptotic fields to be self-adjoint. The hat signifies that $\vb{p}_{n}$ has been removed, which might mean annihilation depending on the structure of $\beta$. Using the asymptotic limit we have
\begin{align*}
	\braket{\beta, \text{out}}{\alpha, \vb{p}_{n}, \text{in}} &= \braket{\beta, \hat{\vb{p}}_{n}, \text{out}}{\alpha, \text{in}} + \frac{i}{\sqrt{Z}}\left(\lim\limits_{x^{0} \to \infty} - \lim\limits_{x^{0} \to -\infty}\right)\mel{\beta, \text{out}}{\integ[3]{}{}{\vb{x}}{f_{p_{n}}\delsw{}{0}\phi}}{\alpha, \text{in}} \\
	&= \braket{\beta, \hat{\vb{p}}_{n}, \text{out}}{\alpha, \text{in}} + \frac{i}{\sqrt{Z}}\mel{\beta, \text{out}}{\integ[4]{}{}{x}{\del{}{0}\left(f_{p_{n}}\delsw{}{0}\phi}\right)}{\alpha, \text{in}} \\
	&= \braket{\beta, \hat{\vb{p}}_{n}, \text{out}}{\alpha, \text{in}} + \frac{i}{\sqrt{Z}}\integ[4]{}{}{x}{\del{}{0}\left(f_{p_{n}}\delsw{}{0}\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}\right)} \\
	&= \braket{\beta, \hat{\vb{p}}_{n}, \text{out}}{\alpha, \text{in}} + \frac{i}{\sqrt{Z}}\integ[4]{}{}{x}{f_{p_{n}}\del{2}{0}\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}} - (\del{2}{0}f_{p_{n}})\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}},
\end{align*}
where we have used the fact that
\begin{align*}
	\del{}{}(a\delsw{}{}b) = \del{}{}(a\del{}{}b - (\del{}{}a)b) = (\del{}{}a)\del{}{}b + a\del{2}{}b - (\del{2}{}a)b - (\del{}{}a)\del{}{}b = a\del{2}{}b - (\del{2}{}a)b.
\end{align*}
The first term is the so-called elastic term, and is zero if $\vb{p}_{n}$ is not in $\beta$, i.e. if there is no forward scattering. In this case we can use the fact that the normal modes solve the Klein-Gordon equation to find
\begin{align*}
	\braket{\beta, \text{out}}{\alpha, \vb{p}_{n}, \text{in}} &= \frac{i}{\sqrt{Z}}\integ[4]{}{}{x}{f_{p_{n}}(\del{2}{0} + m^{2})\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}} - \mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}\laplacian f_{p_{n}}}.
\end{align*}
Studying the last term we find
\begin{align*}
	\integ[3]{}{}{\vb{x}}{\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}\laplacian f_{p_{n}}} &= \integ{}{}{\vb{S}}{\cdot\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}\grad f_{p_{n}}} - \integ[3]{}{}{\vb{x}}{\grad\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}\cdot\grad f_{p_{n}}} \\
	           &= -\integ{}{}{\vb{S}}{\cdot f_{p_{n}}\grad\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}} + \integ[3]{}{}{\vb{x}}{f_{p_{n}}\laplacian\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}} \\
	           &= \integ[3]{}{}{\vb{x}}{f_{p_{n}}\laplacian\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}},
\end{align*}
assuming the field to vanish at infinity. Hence
\begin{align*}
	\braket{\beta, \text{out}}{\alpha, \vb{p}_{n}, \text{in}} &= \frac{i}{\sqrt{Z}}\integ[4]{}{}{x}{f_{p_{n}}(\dalem + m^{2})\mel{\beta, \text{out}}{\phi}{\alpha, \text{in}}}.
\end{align*}
We continue with the matrix element in the integrand. Rewriting it slightly we find
\begin{align*}
	\mel{\gamma, \vb{q}_{m}, \text{out}}{\phi(x)}{\alpha, \text{in}} =& \mel{\gamma, \text{out}}{a_{\text{out}}(\vb{q}_{m})\phi(x)}{\alpha, \text{in}} - \mel{\gamma, \text{out}}{\phi(x)a_{\text{in}}(\vb{q}_{m})}{\alpha, \text{in}} + \mel{\gamma, \text{out}}{\phi(x)a_{\text{in}}(\vb{q}_{m})}{\alpha, \text{in}} \\
	=& \mel{\gamma, \text{out}}{\phi(x)}{\hat{\vb{q}}_{m}, \alpha, \text{in}} \\
	 &+ \mel{\gamma, \text{out}}{i\integ[3]{}{}{\vb{y}}{f_{q_{m}}\cc(y)\delsw{}{y, 0}\phi_{\text{out}}(y)\phi(x)} - i\phi(x)\integ[3]{}{}{\vb{y}}{f_{q_{m}}\cc(y)\delsw{}{y, 0}\phi_{\text{in}}(y)}}{\alpha, \text{in}}.
\end{align*}
Because the normal modes commute with the fields, we find
\begin{align*}
	f_{q_{m}}\cc(y)\delsw{}{y, 0}\phi_{\text{out}}(y) &= f_{q_{m}}\cc(y)\del{}{y, 0}\phi_{\text{out}}(y) - (\del{}{y, 0}f_{q_{m}}\cc(y))\phi_{\text{out}}(y) \\
	                                                  &= \phi_{\text{out}}(y)\del{}{y, 0}f_{q_{m}}\cc(y) + (\del{}{y, 0}\phi_{\text{out}}(y))f_{q_{m}}\cc(y) \\
	                                                  &= -\phi_{\text{out}}(y)\delsw{}{y, 0}f_{q_{m}}\cc(y),
\end{align*}
and thus
\begin{align*}
	\mel{\gamma, \vb{q}_{m}, \text{out}}{\phi(x)}{\alpha, \text{in}} =& \mel{\gamma, \text{out}}{\phi(x)}{\hat{\vb{q}}_{m}, \alpha, \text{in}} \\
	&- i\mel{\gamma, \text{out}}{\integ[3]{}{}{\vb{y}}{\phi_{\text{out}}(y)\phi(x)\delsw{}{y, 0}f_{q_{m}}\cc(y) - \phi(x)\phi_{\text{in}}(y)\delsw{}{y, 0}f_{q_{m}}\cc(y)}}{\alpha, \text{in}} \\
	=& \mel{\gamma, \text{out}}{\phi(x)}{\hat{\vb{q}}_{m}, \alpha, \text{in}} - i\integ[3]{}{}{\vb{y}}{\mel{\gamma, \text{out}}{\phi_{\text{out}}(y)\phi(x) - \phi(x)\phi_{\text{in}}(y)}{\alpha, \text{in}}\delsw{}{y, 0}f_{q_{m}}\cc(y)}.
\end{align*}
Assuming no forward scattering, we use the limit procedure to find
\begin{align*}
	\mel{\gamma, \vb{q}_{m}, \text{out}}{\phi(x)}{\alpha, \text{in}} = - \frac{i}{\sqrt{Z}}\integ[4]{}{}{y}{\del{}{0}\left(\mel{\gamma, \text{out}}{\torp\phi(y)\phi(x)}{\alpha, \text{in}}\delsw{}{y, 0}f_{q_{m}}\cc(y)\right)},
\end{align*}
where we have introduced the time-ordered product to account for the switching of the order when evaluated in the two limits. Repeating the final steps of the previous derivation we find
\begin{align*}
	\mel{\gamma, \vb{q}_{m}, \text{out}}{\phi(x)}{\alpha, \text{in}} &= \frac{i}{\sqrt{Z}}\integ[4]{}{}{y}{(\dalem_{y} + m^{2})\mel{\gamma, \text{out}}{\torp{\phi(x)}{\phi(y)}}{\alpha, \text{in}}f_{q_{n}}\cc(y)}.
\end{align*}

What we have seen now is how removing single momenta from each side of the matrix element. Generalizing this argument to repetitions we find
\begin{align*}
	\braket{\vb{q}_{1}, \dots, \vb{q}_{m}, \text{out}}{\vb{p}_{1}, \dots, \vb{p}_{n}, \text{in}} = \left(\frac{i}{\sqrt{Z}}\right)^{n + m}\prod\limits_{i = 1}^{n}\prod\limits_{j = 1}^{m}\int\dd[4]{x_{i}}\dd[4]{y_{j}}&f_{p_{i}}(x_{i})f_{q_{j}}\cc(y_{j})(\dalem{}_{x_{i}} + m^{2})(\dalem{}_{y_{j}} + m^{2}) \\
	&\times\expval{\torp{\phi(y_{1})\dots\phi(y_{m})}{\phi(x_{1})\dots\phi(x_{n})}}{\Omega}.
\end{align*}

\paragraph{The Interaction Picture}
The most basic pictures of quantum mechanics are the Schrödinger picture, where states evolve by multiplying by the time evolution operator $e^{-iHt}$ and operators are time-independent, and the Heisenberg picture, where operators evolve according to $A(t) = e^{iHt}A(0)e^{-iHt}$. A third picture, which will be used in the proceeding discussion of perturbation theory, is the interaction picture. In this picture, both the states and the operators will evolve in time.

Consider a Hamiltonian of the form
\begin{align*}
	H = H_{\text{in}} + H_{\text{I}}.
\end{align*}
The two terms are the free part and the interaction part. The operators evolve according to
\begin{align*}
	O(t) = e^{iH_{\text{in}}t}O(0)e^{-iH_{\text{in}}t},
\end{align*}
implying an equation of motion
\begin{align*}
	i\dv{O}{t} = \comm{O}{H_{\text{in}}}.
\end{align*}

To preserve expectation values when compared to the Schrödinger picture, we require
\begin{align*}
	\ket{\Psi_{\text{I}}(t)} = e^{iH_{\text{in}}t}\ket{\Psi(t)}.
\end{align*}
Differentiating with respect to time
\begin{align*}
	\dv{t}\ket{\Psi_{\text{I}}(t)} = iH_{\text{in}}e^{iH_{\text{in}}t}\ket{\Psi(t)} + e^{iH_{\text{in}}t}\dv{t}\ket{\Psi(t)} = e^{iH_{\text{in}}t}\left(iH_{\text{in}} - iH\right)\ket{\Psi(t)}.
\end{align*}
We can write this as
\begin{align*}
	i\dv{t}\ket{\Psi_{\text{I}}(t)} = e^{iH_{\text{in}}t}H_{\text{I}}e^{-iH_{\text{in}}t}\ket{\Psi_{\text{I}}(t)},
\end{align*}
or alternatively, by defining $H\p = e^{iH_{\text{in}}t}H_{\text{I}}e^{-iH_{\text{in}}t}$, we have
\begin{align*}
	i\dv{t}\ket{\Psi_{\text{I}}(t)} = H\p\ket{\Psi_{\text{I}}(t)}.
\end{align*}

\paragraph{A Field Transformation Operator}
$\phi$ and $\phi_{\text{in}}$, together with their conjugate momenta, are complete fields that satisfy the same commutation relations. Treating the interacting fields in the Heisenberg picture and the asymptotic fields in the interaction picture, there must be a unitary operator $U(t)$ such that
\begin{align*}
	\phi = U^{-1}\phi_{\text{in}}U,\ \pi = U^{-1}\pi_{\text{in}}U.
\end{align*}
Our task is to find this operator.

We note that the total Hamiltonian is a sum of the free-field Hamiltonian $H_{\text{in}}$ and the interaction Hamiltonian $H_{\text{I}}$. Differentiating the above relation we have:
\begin{align*}
	\dv{t}\phi_{\text{in}} = \dot{U}\phi U^{-1} + U\del{}{t}\phi U^{-1} + U\phi \dot{U}^{-1}.
\end{align*}
The unitarity of $U$ yields
\begin{align*}
	\dot{U}U^{-1} + U\dot{U}^{-1} = 0 \iff \dot{U}^{-1} = -U^{-1}\dot{U}U^{-1},
\end{align*}
hence
\begin{align*}
	\dv{t}\phi_{\text{in}} &= \dot{U}\phi U^{-1} + U\del{}{t}\phi U^{-1} - U\phi U^{-1}\dot{U}U^{-1} \\
	                       &= \dot{U}U^{-1}\phi_{\text{in}} + iU\comm{H(\phi_{\text{in}}, \pi_{\text{in}})}{\phi} U^{-1} - \phi_{\text{in}}\dot{U}U^{-1} \\
	                       &= \comm{\dot{U}U^{-1}}{\phi_{\text{in}}} + i\comm{H(\phi_{\text{in}}, \pi_{\text{in}})}{\phi_{\text{in}}},
\end{align*}
assuming the Hamiltonian to commute with $U$. Now, in the interaction picture the time evolution of the asymptotic field is dictated only by the free-field Hamiltonian, hence
\begin{align*}
	&\comm{\dot{U}U^{-1}}{\phi_{\text{in}}} + i\comm{H(\phi_{\text{in}}, \pi_{\text{in}})}{\phi_{\text{in}}} = i\comm{H_{\text{in}}(\phi_{\text{in}}, \pi_{\text{in}})}{\phi_{\text{in}}}, \\
	&\comm{\dot{U}U^{-1}}{\phi_{\text{in}}} + i\comm{H_{\text{I}}(\phi_{\text{in}}, \pi_{\text{in}})}{\phi_{\text{in}}} = 0.
\end{align*}
Because this commutator is zero for any free field, we must have
\begin{align*}
	\dot{U}U^{-1} + iH_{\text{I}} = -iE_{0},
\end{align*}
yielding the differential equation
\begin{align*}
	i\dot{U} = (H_{\text{I}} + E_{0})U = H_{\text{I}}\p U,
\end{align*}
where we introduced the shifted interaction Hamiltionian $H_{\text{I}}\p = H_{\text{I}} + E_{0}$.

We note that the above equation is very similar to that describing the time evolution operator in non-relativistic quantum mechanics. We therefore introduce the operator
\begin{align*}
	U(t, t\p) = U(t)U^{-1}(t\p),
\end{align*}
which satisfies $U(t, t\p) = U(t, \tau)U(\tau, t\p)$ and
\begin{align*}
	i\del{}{t}U(t, t\p) = H_{\text{I}}\p U(t, t\p).
\end{align*}
We must have $U(t\p, t\p) = 1$, and we thus obtain the integral equation
\begin{align*}
	U(t, t\p) = 1 -i\integ{t\p}{t}{t_{1}}{H_{\text{I}}\p(t_{1})U(t_{1}, t\p)}.
\end{align*}
This can be solved using an iteration scheme
\begin{align*}
	U(t, t\p) =& 1 -i\integ{t\p}{t}{t_{1}}{H_{\text{I}}\p(t_{1})} + (-i)^{2}\integ{t\p}{t}{t_{1}}{\integ{t\p}{t_{1}}{t_{2}}{H_{\text{I}}\p(t_{1})H_{\text{I}}\p(t_{2})}} \\
	           &+ (-i)^{n}\integ{t\p}{t}{t_{1}}{\dots\integ{t\p}{t_{n - 1}}{t_{n}}{\prod\limits_{i = 1}^{n}H_{\text{I}}\p(t_{i})}} + \dots.
\end{align*}
Now we note that this setup is such that the different times appear in order, meaning we can use the time-ordered product. A sneaky trick we can use is that operators commute within time-ordered products, as the time ordering fixes the order. We thus have
\begin{align*}
	\integ{t\p}{t}{t_{1}}{\integ{t\p}{t_{1}}{t_{2}}{\torp{H_{\text{I}}\p(t_{1})}{H_{\text{I}}\p(t_{2})}}} = \integ{t\p}{t}{t_{2}}{\integ{t\p}{t_{2}}{t_{1}}{\torp{H_{\text{I}}\p(t_{2})}{H_{\text{I}}\p(t_{1})}}} = \integ{t\p}{t}{t_{2}}{\integ{t\p}{t_{2}}{t_{1}}{\torp H_{\text{I}}\p(t_{1})H_{\text{I}}\p(t_{2})}},
\end{align*}
and we can symmetrize according to
\begin{align*}
	\integ{t\p}{t}{t_{1}}{\integ{t\p}{t_{1}}{t_{2}}{\torp{H_{\text{I}}\p(t_{1})}{H_{\text{I}}\p(t_{2})}}} = \frac{1}{2}\integ{t\p}{t}{t_{1}}{\integ{t\p}{t}{t_{2}}{\torp{H_{\text{I}}\p(t_{1})}{H_{\text{I}}\p(t_{2})}}}.
\end{align*}
We thus end up with
\begin{align*}
	U(t, t\p) = 1 + \sum\limits_{n = 1}^{\infty}\frac{(-i)^{n}}{n!}\integ{t\p}{t}{t_{1}}{\dots\integ{t\p}{t}{t_{n}}{\torp\prod\limits_{i = 1}^{n}H_{\text{I}}\p(t_{i})}} = \torp\exp(-i\integ{t\p}{t}{\tau}{H_{\text{I}}\p(\tau)}) = \torp\exp(-i\integ[4]{}{}{x}{\ham_{\text{I}}\p(\phi_{\text{in}}, \pi_{\text{in}})}),
\end{align*}
where we have introduced the time-ordered exponential and the Hamiltonian density corresponding to the interaction. This expansion, in particular, the second-to-last expression, is called the Dyson expansion.

\paragraph{Back To VEVs}
We now return to the issue of computing vacuum expectation values. Consider the expectation value
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) = \expval{\torp\prod\limits_{i = 1}^{n}\phi(x_{i})}{\Omega}.
\end{align*}
We have
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) &= \expval{\torp\prod\limits_{i = 1}^{n}U^{-1}(t_{i})\phi_{\text{in}}(x_{i})U(t_{i})}{\Omega} \\
	                          &= \expval{\torp U^{-1}(t_{1})\phi_{\text{in}}(x_{1})U(t_{1}, t_{2})\phi_{\text{in}}(x_{2})\dots U(t_{n - 1}, t_{n})\phi_{\text{in}}(x_{n})U(t_{n})}{\Omega}.
\end{align*}
Introducing a $t$ that is greater than all involved times (implying that $-t$ is smaller than all times) we have
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) = \expval{\torp U^{-1}(t)U(t, t_{1})\phi_{\text{in}}(x_{1})U(t_{1}, t_{2})\phi_{\text{in}}(x_{2})\dots U(t_{n - 1}, t_{n})\phi_{\text{in}}(x_{n})U(t_{n}, -t)U(-t)}{\Omega}.
\end{align*}
In the limit of $t\to\infty$ we can somehow extract the $U$ and rearrange the operators to find
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) &= \expval{U^{-1}(t)\torp (\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2})\dots \phi_{\text{in}}(x_{n})U(t, t_{1})U(t_{1}, t_{2})\dots U(t_{n - 1}, t_{n})U(t_{n}, -t))U(-t)}{\Omega} \\
	                          &= \expval{U^{-1}(t)\torp\left(\phi_{\text{in}}(x_{1})\dots \phi_{\text{in}}(x_{n})U(t, -t)\right)U(-t)}{\Omega} \\
	                          &= \expval{U^{-1}(t)\torp\left(\phi_{\text{in}}(x_{1})\dots \phi_{\text{in}}(x_{n})e^{-i\integ{-t}{t}{\tau}{H_{\text{I}\p(\tau)}}}\right)U(-t)}{\Omega}
\end{align*}

Next we want to show that $\ket{\Omega}$ is an eigenstate of $U(-t)$, as that will allow us to remove the $U$s. We therefore look at the state $\mel{\alpha, \vb{p}, \text{in}}{U(-t)}{\Omega}$. It can be shown that as $t$ goes to infinity, this matrix element approaches zero, meaning
\begin{align*}
	\lim\limits_{t\to\infty}U(\pm t)\ket{\Omega} = \lambda_{\pm}\ket{\Omega}.
\end{align*}
This means that for the physical vacuum, adding the completeness relation amounts to just multiplying by $\op{\Omega}$. In the limit we thus have
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) &= \expval{U^{-1}(t)\torp\left(\phi_{\text{in}}(x_{1})\dots \phi_{\text{in}}(x_{n})e^{-i\integ{-t}{t}{\tau}{H_{\text{I}\p(\tau)}}}\right)U(-t)}{\Omega} \\ 
	                          &=\expval{U^{-1}(t)}{\Omega}\expval{\torp\phi_{\text{in}}(x_{1})\dots \phi_{\text{in}}(x_{n})e^{-i\integ{-t}{t}{\tau}{H_{\text{I}\p(\tau)}}}}{\Omega}\expval{U(-t)}{\Omega} \\
	                          &= \lambda_{+}\cc\lambda_{-}\expval{\torp\phi_{\text{in}}(x_{1})\dots \phi_{\text{in}}(x_{n})e^{-i\integ{-t}{t}{\tau}{H_{\text{I}\p(\tau)}}}}{\Omega}.
\end{align*}
To prepare for the final step, we note that
\begin{align*}
	\lambda_{+}\cc\lambda_{-} = \expval{U(-t, t)}{\Omega}
\end{align*}
according to the definition, hence
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) = \frac{\expval{\torp\phi_{\text{in}}(x_{1})\dots \phi_{\text{in}}(x_{n})e^{-i\integ{-t}{t}{\tau}{H_{\text{I}\p(\tau)}}}}{\Omega}}{\expval{\torp e^{-i\integ{-t}{t}{\tau}{H_{\text{I}\p(\tau)}}}}{\Omega}}.
\end{align*}

\paragraph{Switching Vacuua}
The physical and free vacuua are not orthogonal in the case of small perturbations. Expanding in eigenstates of the total Hamiltonian we have
\begin{align*}
	e^{-iHt}\ket{0} = e^{-iE_{0}t}\ket{\Omega}\braket{\Omega}{0} + \sum\limits_{n > 0}e^{-iE_{n}t}\ket{n}\braket{n}{0}.
\end{align*}
Because the energies are ordered, we can approach infinite time as $t\to (1 + i\varepsilon)\infty$ for some small $\varepsilon$ to find that all the exponentials corresponding to excited states approach zero faster than the others, meaning
\begin{align*}
	\ket{\Omega} = \lim\limits_{t\to\infty}\frac{1}{\braket{\Omega}{0}}e^{iE_{0}t}e^{-iHt}\ket{0}.
\end{align*}
In this limit we may add a small time shift without changing the result. Defining energy such that the ground state of the free Hamiltonian has zero energy, we may write
\begin{align*}
	\ket{\Omega} &= \lim\limits_{t\to\infty}\frac{1}{\braket{\Omega}{0}}e^{iE_{0}(t + t_{0})}e^{-iH(t + t_{0})}\ket{0} \\
	             &= \lim\limits_{t\to\infty}\frac{1}{\braket{\Omega}{0}}e^{iE_{0}(t_{0} - (-t))}e^{-iH(t_{0} - (-t))}e^{iH_{\text{in}}(t_{0} - (-t))}\ket{0} \\
	             &= \lim\limits_{t\to\infty}\frac{1}{\braket{\Omega}{0}}e^{iE_{0}(t_{0} - (-t))}e^{-i(H - H_{\text{in}})(t_{0} - (-t))}\ket{0} \\
	             &= \lim\limits_{t\to\infty}\frac{1}{\braket{\Omega}{0}}e^{iE_{0}(t - (-t_{0}))}U(t_{0}, -t)\ket{0}.
\end{align*}
By similar arguments it can be shown that
\begin{align*}
	\bra{\Omega} &= \lim\limits_{t\to\infty}\frac{1}{\braket{0}{\Omega}}e^{iE_{0}(t - t_{0})}\bra{0}U(t, t_{0}).
\end{align*}

Returning to the issue of the time-ordered product we have
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) &= \lim\limits_{t\to\infty}\frac{1}{\abs{\braket{\Omega}{0}}^{2}}e^{2iE_{0}t}\expval{U(t, t_{0})U^{-1}(t)\torp(\phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{n}))U(t, -t)U(-t)U(t_{0}, -t)}{0}.
\end{align*}
Choosing $t_{0} = 0$ we have
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) &= \lim\limits_{t\to\infty}\frac{1}{\abs{\braket{\Omega}{0}}^{2}}e^{2iE_{0}t}\expval{U(t)U^{-1}(t)\torp(\phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{n}))U(t, -t)U(-t)U(-t)^{-1}}{0} \\
	                          &= \lim\limits_{t\to\infty}\frac{1}{\abs{\braket{\Omega}{0}}^{2}}e^{2iE_{0}t}\expval{\torp \phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{n})U(t, -t)}{0}.
\end{align*}
Requiring the physical vacuum to be normalized we find
\begin{align*}
	\lim\limits_{t\to\infty}\frac{1}{\abs{\braket{\Omega}{0}}^{2}}e^{2iE_{0}t}\expval{U(t, -t)}{0} = 1,
\end{align*}
and thus
\begin{align*}
	\tau(x_{1}, \dots, x_{n}) = \lim\limits_{t\to\infty}\frac{\expval{\torp \phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{n})}{0}}{\expval{U(t, -t)}{0}}.
\end{align*}
We have thus reduced the problem of computing expectation values in the interacting theory to that of computing them in the free theory.

\paragraph{Relating Time and Normal Ordering}
To compute expectation values of the form $\expval{\torp\phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{n})}{0}$, we divide the fields into two terms $\phi_{\text{in}}(x) = \phi_{\text{in}, +}(x) + \phi_{\text{in}, }(x_{1})$ where the two terms contain all positive and negative frequencies respectively, i.e. all annihilation and creation operators. The purpose is to express the time-ordered product as something containing a normal ordered product, which has zero vacuum expectation value. Assuming $x_{1}^{0} > x_{2}^{0}$ we have
\begin{align*}
	\torp\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2}) =& \phi_{\text{in}, +}(x_{1})\phi_{\text{in}, +}(x_{2}) + \phi_{\text{in}, +}(x_{1})\phi_{\text{in}, -}(x_{2}) + \phi_{\text{in}, -}(x_{1})\phi_{\text{in}, +}(x_{2}) + \phi_{\text{in}, -}(x_{1})\phi_{\text{in}, -}(x_{2}).
\end{align*}
We reorder the terms by writing
\begin{align*}
	\torp\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2}) =& \phi_{\text{in}, +}(x_{1})\phi_{\text{in}, +}(x_{2}) + \comm{\phi_{\text{in}, +}(x_{1})}{\phi_{\text{in}, -}(x_{2})} + \phi_{\text{in}, -}(x_{2})\phi_{\text{in}, +}(x_{1}) \\
	                                                     &+ \phi_{\text{in}, -}(x_{1})\phi_{\text{in}, +}(x_{2}) + \phi_{\text{in}, -}(x_{1})\phi_{\text{in}, -}(x_{2}).
\end{align*}
We now define the Wick contraction of two fields
\begin{align*}
	\contraction{}{\phi_{\text{in}}(x_{1})}{}{\phi_{\text{in}}(x_{2})}\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2}) = \phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2}) - \nop{\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2})},
\end{align*}
and from the above we see that
\begin{align*}
	\contraction{}{\phi_{\text{in}}(x_{1})}{}{\phi_{\text{in}}(x_{2})}\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2}) =
	\begin{cases}
		\comm{\phi_{\text{in}, +}(x_{1})}{\phi_{\text{in}, -}(x_{2})},\ x_{1}^{0} > x_{2}^{0} \\
		\comm{\phi_{\text{in}, +}(x_{2})}{\phi_{\text{in}, -}(x_{1})},\ x_{2}^{0} > x_{1}^{0},
	\end{cases}
\end{align*}
This yields
\begin{align*}
	\torp\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2}) &= \nop{\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2}) + \contraction{}{\phi_{\text{in}}(x_{1})}{}{\phi_{\text{in}}(x_{2})}\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2})}.
\end{align*}

What is this contraction? Using the expression for the two kinds of modes we have
\begin{align*}
	\comm{\phi_{\text{in}, +}(x_{1})}{\phi_{\text{in}, -}(x_{2})} &= \frac{1}{2(2\pi)^{3}}\integ[3]{}{}{\vb{k}}{\integ[3]{}{}{\vb{q}}{\frac{1}{k^{0}q^{0}}e^{i\vb{q}\cdot\vb{x}_{2} - i\vb{k}\cdot\vb{x}_{1}}\comm{a(\vb{k})}{a\adj(\vb{q})}}} \\
	&= \frac{1}{2(2\pi)^{3}}\integ[3]{}{}{\vb{k}}{\integ[3]{}{}{\vb{q}}{\frac{1}{k^{0}}e^{i\vb{q}\cdot\vb{x}_{2} - i\vb{k}\cdot\vb{x}_{1}}\delta(\vb{k} - \vb{q})}} \\
	&= \frac{1}{2(2\pi)^{3}}\integ[3]{}{}{\vb{k}}{\frac{1}{k^{0}}e^{-i\vb{k}\cdot(\vb{x}_{1} - \cdot\vb{x}_{2})}} \\
	&= i\kgprop{+}{x_{1} - x_{2}}, \\
	\comm{\phi_{\text{in}, +}(x_{2})}{\phi_{\text{in}, -}(x_{1})} &= \frac{1}{2(2\pi)^{3}}\integ[3]{}{}{\vb{k}}{\frac{1}{k^{0}}e^{-i\vb{k}\cdot(\vb{x}_{2} - \cdot\vb{x}_{1})}} = -i\kgprop{-}{x - y},
\end{align*}
hence we conclude
\begin{align*}
	\contraction{}{\phi_{\text{in}}(x_{1})}{}{\phi_{\text{in}}(x_{2})}\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2}) = i\kgprop{F}{x - y}.
\end{align*}

Other contractions may also be computed. We have
\begin{align*}
	\contraction{}{\psi_{\text{in}}(x_{1})}{}{\overline{\psi}_{\text{in}}(x_{2})}\psi_{\text{in}}(x_{1})\overline{\psi}_{\text{in}}(x_{2}) = -\contraction{}{\overline{\psi}_{\text{in}}(x_{2})}{}{\psi_{\text{in}}(x_{1})}\overline{\psi}_{\text{in}}(x_{2})\psi_{\text{in}}(x_{1}) = i\dirprop{F}{}{x_{1} - x_{2}},\ \contraction{}{A_{\mu}(x_{1})}{}{A_{\nu}(x_{2})}A_{\mu}(x_{1})A_{\nu}(x_{2}) = i\phprop{\mu}{\nu}{x_{1} - x_{2}}.
\end{align*}

\paragraph{Wick's Theorem}
Wick's theorem states that
\begin{align*}
	\torp\phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{n}) = \nop{\phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{n}) + \text{ all possible contractions}}
\end{align*}
for bosonic fields. For fermionic fields, the connection terms are multiplied by a factor of $-1$ to the power of the number of times the fields must be reordered to appear in the order in which they are contracted.

We will prove this theorem for the case of a bosonic field. We have already shown it to be true for the product of two fields, setting us up for a proof by induction. Assume Wick's theorem to hold for $n$ fields, and add an extra field. Because operators commute within time ordering, we may relabel the coordinates such that they are in order, implying
\begin{align*}
	\torp\phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{n + 1}) &= \phi_{\text{in}}(x_{1})\torp\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{n + 1}) \\
	&= \phi_{\text{in}}(x_{1})\left(\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{n + 1}) + \sum\text{contractions}}\right).
\end{align*}
To prove the theorem, we must bring this expression to normal ordered form. It might be useful to strategize first, however, so let us do that. Consider the terms containing exclusively contractions of the last $n - k$ fields as an example. In the $n$ case, these contain the normal ordered product of the first $k$ fields. If Wick's theorem is to hold for the $n + 1$ case, we expect that the corresponding terms should contain a normal ordered product of the first $k + 1$ fields, as well as terms with a single contractions of the new field with all the old ones. The truth of this would imply that all contractions are both preserved and augmented by an extra contraction, proving the induction statement. We would therefore like to prove that
\begin{align*}
	\phi_{\text{in}}(x_{1})\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})} = \nop{\phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{k + 1}) + \sum\limits_{m = 2}^{k + 1}\contraction{}{\phi_{\text{in}}(x_{1})}{\dots}{\phi_{\text{in}}(x_{m})}\phi_{\text{in}}(x_{1})\dots\phi_{\text{in}}(x_{m})\dots}.
\end{align*}
Note that this guarantees the truth of the theorem because this is done for all $k$ and by swapping the first $k + 1$ fields with other fields that are contracted in this case.

On the left-hand side we may split $\phi_{\text{in}}(x_{1})$ into its creation and annihilation parts. By introducing the commutator, we find
\begin{align*}
	\phi_{\text{in}}(x_{1})\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})} =& \phi_{\text{in}, -}(x_{1})\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})} + \comm{\phi_{\text{in}, +}(x_{1})}{\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})}} \\
	 &+ \nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})}\phi_{\text{in}, +}(x_{1}) \\
	=& \nop{\phi_{\text{in}, -}(x_{1})\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})} + \nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})\phi_{\text{in}, +}(x_{1})} \\
	 &+ \comm{\phi_{\text{in}, +}(x_{1})}{\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})}} \\
	=& \nop{\phi_{\text{in}}(x_{1})\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})} + \comm{\phi_{\text{in}, +}(x_{1})}{\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})}}.
\end{align*}
The hope is then that the commutator term contains all the connections.

To whittle it down, we note that
\begin{align*}
	\comm{A_{1}}{A_{2}\dots A_{k + 1}} &= \comm{A_{1}}{A_{2}\dots A_{k}}A_{k + 1} + A_{2}\dots A_{k}\comm{A_{1}}{A_{k + 1}} \\
	                                   &= \left(\comm{A_{1}}{A_{2}\dots A_{k - 1}}A_{k} + A_{2}\dots A_{k - 1}\comm{A_{1}}{A_{k}}\right)A_{k + 1} + A_{2}\dots A_{k}\comm{A_{1}}{A_{k + 1}}
	                                   &= \dots \\
	                                   &= \sum\limits_{i = 2}^{k + 1}A_{2}\dots A_{i - 1}\comm{A_{1}}{A_{i}}A_{i + 1}\dots A_{k + 1}.
\end{align*}
Writing the normal ordered product as
\begin{align*}
	\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})} =& \sum\limits_{P(2, \dots, k + 1)}\sum\limits_{m = 2}^{k}\phi_{\text{in}, -}(x_{P(2)})\dots\phi_{\text{in}, -}(x_{P(m)})\phi_{\text{in}, +}(x_{P(m + 1)})\dots\phi_{\text{in}, +}(x_{P(k + 1)}) \\
	&+ \phi_{\text{in}, +}(x_{2})\dots\phi_{\text{in}, +}(x_{k + 1}),
\end{align*}
we have
\begin{align*}
	&\comm{\phi_{\text{in}, +}(x_{1})}{\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})}} \\
	=& \sum\limits_{P(2, \dots, k + 1)}\sum\limits_{m = 2}^{k}\comm{\phi_{\text{in}, +}(x_{1})}{\phi_{\text{in}, -}(x_{P(2)})\dots\phi_{\text{in}, -}(x_{P(m)})\phi_{\text{in}, +}(x_{P(m + 1)})\dots\phi_{\text{in}, +}(x_{P(k + 1)})} \\
	=& \sum\limits_{P(2, \dots, k + 1)}\sum\limits_{m = 2}^{k}\sum\limits_{i = 2}^{m}\phi_{\text{in}, -}(x_{P(2)})\dots\phi_{\text{in}, -}(x_{P(i)})\comm{\phi_{\text{in}, +}(x_{1})}{\phi_{\text{in}, -}(x_{P(i)})}\phi_{\text{in}, -}(x_{P(i + 1)})\dots\phi_{\text{in}, -}(x_{P(m)})\phi_{\text{in}, +}(x_{P(m + 1)})\dots
\end{align*}
We can extend the summation over $i$ to stop at $k + 1$, yielding
\begin{align*}
	\comm{\phi_{\text{in}, +}(x_{1})}{\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{k + 1})}} &= \sum\limits_{i = 2}^{k + 1}\nop{\phi_{\text{in}}(x_{2})\dots\phi_{\text{in}}(x_{i - 1})\comm{\phi_{\text{in}, +}(x_{1})}{\phi_{\text{in}}(x_{i})}\phi_{\text{in}}(x_{i + 1})\dots\phi_{\text{in}}(x_{k + 1})}.
\end{align*}
We recognize the commutator in the sum as the desired contraction, and the proof is thus complete.

\paragraph{More on Feynman Diagrams}
We will now illustrate some more uses of Feynman diagrams in obtaining mathematical expressions that can be computed. First, we consider a Klein-Gordon theory with perturbation
\begin{align*}
	H_{\text{I}}\p = \frac{\lambda}{4!}\phi^{4}.
\end{align*}
We will write the expectation value
\begin{align*}
	\expval{\torp\phi_{\text{in}}(x)\phi_{\text{in}}(y)e^{-i\integ{-\infty}{\infty}{\tau}{H_{\text{I}}\p(\tau)}}}{0}
\end{align*}
as a sum of Feynman diagrams with two external points. We have already seen the propagator in both position and momentum space, corresponding to multiplication by a propagator. In addition we introduce the vertex
\begin{figure}[!ht]
	\centering
	\subfloat[Position space.]{
		\feynmandiagram[vertical = i1 to i3]{
			{i1, i3} --[scalar] a[dot, label = $z$] --[scalar] {i2, i4},
		};
	}
	\subfloat[Momentum space.]{
		\feynmandiagram[vertical = i1 to i3]{
			{i1, i3} --[charged scalar] a[dot, label = $z$] --[charged scalar] {i2, i4},
		};
	}
\end{figure}
which corresponds to adding $-i\lambda\integ[4]{}{}{z}{}$ and $-i\lambda$. There are also external points
\begin{figure}[!ht]
	\centering
	\subfloat[Position space.]{
		\feynmandiagram[horizontal = a to b]{
			a[dot, label = $x$] --[scalar] b,
		};
	}
	\subfloat[Momentum space.]{
		\feynmandiagram[horizontal = a to b]{
			a[dot] --[anti charged scalar, edge label = $p$] b,
		};
	}
\end{figure}
which correspond to multiplication by $1$ and $e^{-ipx}$ respectively. One also has to divide by symmetry factors. In addition, $p$ must be conserved at all vertices and undetermined momenta add $\frac{1}{(2\pi)^{4}}\integ[4]{}{}{p}{}$ in momentum space.

Returning to the expectation value in question, we find to different orders in the perturbation that it is equal to
\begin{figure}[!ht]
	\centering
	\feynmandiagram[horizontal = a to b]{
		a[dot, label = $x$] --[scalar] b[dot, label = $y$],
	}; + 
	\feynmandiagram[horizontal = a to b, layered layout]{
		a[dot, label = $x$] --[scalar] b --[scalar, out = 135, in = 45, loop, min distance = 2cm]b --[scalar] c[dot, label = $y$],
	}; + 
	\feynmandiagram[horizontal = a to b, layered layout]{
		a[dot, label = $x$] --[scalar] b --[scalar] c --[scalar] d[dot, label = $y$],
		b --[scalar, half left] c,
		c --[scalar, half left] b,
	}; + \dots
\end{figure}
multiplied by the exponential of the sum of the diagrams
\begin{figure}[!ht]
	\centering
	\feynmandiagram[]{
		a --[scalar, out = 135, in = 45, loop, min distance = 2cm] a --[scalar, out = -135, in = -45, loop, min distance = 2cm] a,
	}; + 
	\feynmandiagram[vertical = a to b]{
		a --[scalar, out = 135, in = 45, loop, min distance = 2cm] a --[scalar, half left] b --[scalar, out = -135, in = -45, loop, min distance = 2cm] b --[scalar, half left] a,
	}; + 
	\feynmandiagram[vertical = a to b]{
		a --[scalar, half left] b --[scalar, half left] a --[scalar, out = -60, in = 60] b --[scalar, out = 120, in = -120] a,
	};
\end{figure}
which is equal to
\begin{align*}
	\expval{\torp e^{-i\integ{-\infty}{\infty}{\tau}{H_{\text{I}}\p(\tau)}}}{0}.
\end{align*}
This implies
\begin{align*}
	\mel{\torp\phi_{\text{in}}(x)\phi_{\text{in}}(y)}{\Omega} = \expval{\torp\phi_{\text{in}}(x)\phi_{\text{in}}(y)e^{-i\integ{-\infty}{\infty}{\tau}{H_{\text{I}}\p(\tau)}}}{0}_{\text{c}},
\end{align*}
where the subscript denotes a division by $\expval{\torp e^{-i\integ{-\infty}{\infty}{\tau}{H_{\text{I}}\p(\tau)}}}{0}$.

Next we consider Yukawa theory, which is a simplified version of QED consisting of a Dirac field and a Klein-Gordon field interacting with
\begin{align*}
	H_{\text{I}}\p = g\bar{\Psi}\phi\Psi.
\end{align*}
In momentum space we represent $\contraction{}{\phi(x)}{}{\phi(y)}\phi(x)\phi(y)$ and $\Psi\bar{\Psi}$ by the Feynman diagrams
\begin{figure}[!ht]
	\centering
	\feynmandiagram[horizontal = a to b]{
		a --[charged scalar, edge label = $q$] b,
	};
	\feynmandiagram[horizontal = a to b]{
		a --[fermion, edge label = $p$] b,
	};
\end{figure}
which correspond to multiplication by
\begin{align*}
	\frac{1}{q^{2} - m_{\phi}^{2} + i\varepsilon},\ i\frac{\fsl{p} + m}{p^{2} - m^{2} + i\varepsilon}
\end{align*}
respectively, where $m_{\phi}$ is the bare mass of the Klein-Gordon field. We also have the vertex
\begin{figure}[!ht]
	\centering
	\feynmandiagram[horizontal = a to b]{
		i1 --[anti fermion] a --[anti fermion] i2,
		a --[scalar] b,
	};
\end{figure}
which corresponds to a multiplication by $-ig$.

Finally there is quantum electrodynamics, which contains of a Dirac field interacting with the electromagnetic field. The interaction Hamiltonian is
\begin{align*}
	H_{\text{I}}\p = \integ[3]{}{}{\vb{x}}{e\bar{\Psi}\gamma^{\mu}\Psi A_{\mu}}.
\end{align*}
The two relevant propagators are represented as
\begin{figure}[!ht]
	\centering
	\feynmandiagram[horizontal = a to b]{
		a --[fermion, edge label = $p$] b,
	};
	\feynmandiagram[horizontal = a to b]{
		a[label = $\mu$] --[photon, momentum = {$q$}] b[label = $\nu$],
};
\end{figure}
where the momentum arrow is supposed to point left. This corresponds to multiplication by
\begin{align*}
	i\frac{\fsl{p} + m}{p^{2} - m^{2} + i\varepsilon},\ -i\frac{g^{\mu\nu}}{q^{2} + i\varepsilon}
\end{align*}
respectively. There is also the vertex
\begin{figure}[!ht]
	\centering
	\feynmandiagram[horizontal = a to b]{
		i1 --[anti fermion] a --[anti fermion] i2,
		a --[photon] b[label = \mu],
	};
\end{figure}
which corresponds to multiplication by $-ie\gamma^{\mu}$.

\paragraph{Obtaining Feynman Rules: An Example}
We will here demonstrate how to obtain Feynman rules using the results we have derived, using $\phi^{4}$ theory as an example.

We start with the interaction Hamiltonian
\begin{align*}
	H_{\text{I}} = \frac{\lambda}{4!}\phi^{4}.
\end{align*}
Suppose now that we want to study incoming and outgoing states with defined momenta. We are looking for
\begin{align*}
	\mel{q}{S}{p} = (2\pi)^{3}\sqrt{4E_{\vb{p}}E_{\vb{q}}}\expval{a_{\vb{q}}Sa_{\vb{p}}\adj}{0}.
\end{align*}
Next we use the Dyson expansion
\begin{align*}
	S = \torp\left(e^{-i\integ[4]{}{}{x}{H_{\text{I}}}}\right) = \torp\left(1 - i\integ[4]{}{}{x}{H_{\text{I}}(x)} - \frac{1}{2}\integ[4]{}{}{x}{\integ[4]{}{}{y}{H_{\text{I}}(x)H_{\text{I}}(y)}} + \dots\right)
\end{align*}
to write the desired matrix element as
\begin{align*}
	\mel{q}{S}{p} &= (2\pi)^{3}\sqrt{4E_{\vb{p}}E_{\vb{q}}}\expval{a_{\vb{q}}\torp\left(1 - i\integ[4]{}{}{x}{H_{\text{I}}(x)} - \frac{1}{2}\integ[4]{}{}{x}{\integ[4]{}{}{y}{H_{\text{I}}(x)H_{\text{I}}(y)}} + \dots\right)a_{\vb{p}}\adj}{0} \\
	              &= (2\pi)^{3}\sqrt{4E_{\vb{p}}E_{\vb{q}}}\expval{a_{\vb{q}}\torp\left(1 - \frac{i\lambda}{4!}\integ[4]{}{}{x}{\phi^{4}(x)} - \frac{1}{2}\left(\frac{i\lambda}{4!}\right)^{4}\integ[4]{}{}{x}{\integ[4]{}{}{y}{\phi^{4}(x)\phi^{4}(y)}} + \dots\right)a_{\vb{p}}\adj}{0}.
\end{align*}
This is a perturbative expansion of the matrix element. The next step is to use Wick's theorem to simplify this. Writing the different orders as $S_{qp}^{(n)}$, we first study the first-order correction
\begin{align*}
	S_{qp}^{(1)} = -\frac{i\lambda}{4!}(2\pi)^{3}\sqrt{4E_{\vb{p}}E_{\vb{q}}}\expval{a_{\vb{q}}\torp\left(\integ[4]{}{}{x}{\phi^{4}(x)}\right)a_{\vb{p}}\adj}{0} = -\frac{i\lambda}{4!}(2\pi)^{3}\sqrt{4E_{\vb{p}}E_{\vb{q}}}\expval{\torp \integ[4]{}{}{x}{a_{\vb{q}}\phi^{4}(x)a_{\vb{p}}}\adj}{0}.
\end{align*}
Looking at this, Wick's theorem produces a term which separates the single operators from the fields. There are three such terms. The other contains contractions of the fields with the single operators. We somehow find
\begin{align*}
	\contraction{}{\phi}{(x)}{a\adj}\phi(x)a\adj(\vb{p}) = \frac{1}{(2\pi)^{\frac{3}{2}}}\frac{1}{\sqrt{2\omega(\vb{p})}}e^{-ipx},\ \contraction{}{a}{(\vb{p})}{\phi}a(\vb{p})\phi(x) = \frac{1}{(2\pi)^{\frac{3}{2}}}\frac{1}{\sqrt{2\omega(\vb{p})}}e^{ipx},\ \contraction{}{a}{(\vb{p})}{a\adj}a(\vb{p})a\adj(\vb{q}) = \delta(\vb{p} - \vb{q}).
\end{align*}
There are twelve terms of this kind, and it is given by
\begin{align*}
	&12(2\pi)^{3}\sqrt{4\omega(\vb{p})\omega(\vb{q})}\frac{-i\lambda}{4!}\integ[4]{}{}{z}{\frac{1}{(2\pi)^{\frac{3}{2}}}\frac{1}{\sqrt{2\omega(\vb{p})}}e^{-ipz}\frac{1}{(2\pi)^{\frac{3}{2}}}\frac{1}{\sqrt{2\omega(\vb{p})}}e^{iqz}\integ[4]{}{}{k}{\frac{1}{(2\pi)^{4}}\frac{e^{-ik(z - z)}}{k^{2} - m^{2} + i\varepsilon}}} \\
	=& \frac{-i\lambda}{2}\integ[4]{}{}{z}{e^{-i(p - q)z}\integ[4]{}{}{k}{\frac{1}{(2\pi)^{4}}\frac{1}{k^{2} - m^{2} + i\varepsilon}}}
\end{align*}

Finally we try to make sense of the individual terms in Wick's theorem by drawing a Feynman diagram according to the following rules:
\begin{itemize}
	\item Draw a number of vertices equal to the number of interactions you are considering.
	\item Contractions between the incoming state and a field produce a leg with an external point and incoming direction. Similarly, contractions with the outgoing state create outgoing legs.
	\item Contractions between fields create loops in the diagram.
\end{itemize}

\paragraph{Scattering Cross-Sections}
Consider two volumes of particles with lengths $l_{A}$ and $l_{B}$ and particle densities $\rho_{A}$ and $\rho_{B}$ normal to the length approaching one another. If $\Phi$ is the cross-sectional area common to the volumes we define the scattering cross-section as
\begin{align*}
	\sigma = \frac{\text{number of scattering events}}{l_{A}\rho_{A}l_{B}\rho_{B}\Phi}.
\end{align*}
The number of scattering events is then
\begin{align*}
	\sigma l_{A}l_{B}\integ[2]{}{}{\vb{x}}{\rho_{A}\rho_{B}}.
\end{align*}
To study this, we will expand the S-matrix as $S = 1 + iT$. In particular, for the case of two particles, there exists an invariant element $M$ such that
\begin{align*}
	\mel{\vb{p}_{a}, p_{b}}{iT}{p_{A}, p_{B}} = (2\pi)^{4}\delta\left(p_{A} + p_{B} - \sum\limits_{f}p_{f}\right)iM(p_{A} + p_{B} \to p_{f}).
\end{align*}
We can on this basis show that
\begin{align*}
	\dd{\sigma} = \frac{1}{4E_{A}E_{B}\abs{v_{A} - v_{B}}}\prod\limits_{f}\dd[3]{\vb{p}_{f}}\frac{1}{(2\pi)^{3}}\frac{1}{2E_{f}}\abs{M}^{2}\cdot (2\pi)^{4}\delta^{4}\left(p_{A} + p_{B} - \sum\limits_{f}p_{f}\right).
\end{align*}

\paragraph{Decay Rates}
Consider a reaction $a\to b + c + \dots$. It can be shown that decay rates can be computed according to
\begin{align*}
	\dd{\Gamma} = \frac{1}{2m_{a}}(2\pi)^{4}\delta^{4}\left(p_{a} - \sum\limits_{\text{products}}p_{f}\right)\abs{M(a \to b + c + \dots)}^{2}\left(\prod\limits_{\text{products}}\dd[3]{\vb{p}_{f}}\frac{1}{(2\pi)^{3}}\right).
\end{align*}
From this, lifetimes are given by $\tau = \frac{1}{\Gamma}$.