\section{Negativ återkoppling}

\paragraph{Vad är negativ återkoppling?}
I denna kursen kommer vi att studera hur man kontrollerar ett system vid att låta avvikelsen mot det önskade värdet kontrollera regleringen av storheten.

\paragraph{Illustration i blockdiagram}
Ett enkelt negativt kontrollsystem illustrearas i figur \ref{fig:negative_feedback}.

\begin{figure}[!ht]
	\centering
	\includegraphics[width = \textwidth]{./Images/negative_feedback.eps}
	\caption{Schematisk illustration av ett enkelt negativt återkopplad system.}
	\label{fig:negative_feedback}
\end{figure}

\paragraph{Beskrivning av systemet}
Vi börjar beskrivningen av systemet med att inte betrakta störningar. I ena ändpunkten har vi
\begin{align*}
	Y = GU = GFE.
\end{align*}
Summationskomponenten till vänster ger oss
\begin{align*}
	E = R - Y,
\end{align*}
och därmed
\begin{align*}
	Y = GFR - GFY.
\end{align*}
Därmed kan vi skriva
\begin{align*}
	Y = \frac{GF}{1 + GF}R.
\end{align*}

\paragraph{Återkopplad överföringsfunktion}
För ett återkopplad system som kan skrivas som $Y = G_{\text{C}}R$ definieras $G_{\text{C}}$ som den återkopplade överföringsfunktionen. För systemet ovan har vi alltså
\begin{align*}
	G_{\text{C}} = \frac{GF}{1 + GF}R.
\end{align*}

\paragraph{Samband mellan reglerfel och referens}
Alternativt kan vi lösa systemet ovan för att få
\begin{align*}
	R - E = GFE,\ E = \frac{1}{1 + GF}R.
\end{align*}

\paragraph{Samband mellan referens och insignal}
Systemet ovan kan även lösas för att ge
\begin{align*}
	U = FR - FY = FR - GFU,\ U = \frac{F}{1  + GF}R.
\end{align*}

\paragraph{Slutna systems poler}
Vi ser att slutna system har poler där $1 + GF = 0$. Därmed bestäms systemets stabilitet av systemet och regulatorn.

\paragraph{P-reglering}
Principet i P-reglering är att välja en styrsignal som är proportionell mot storleken av felet, alltså
\begin{align*}
	u = K(r - y) = Ke.
\end{align*}
Det är här klart att för att få negativ återkoppling väljer vi $K > 0$.

Denna regleringsmetoden
\begin{itemize}
	\item minskar inverkan av störning och modellfel för ett bra val av $K$.
	\item ökar snabbheten vid insvängning.
	\item stabiliserar instabila system.
\end{itemize}
Däremot kan regleringen gå fel om t.ex.
\begin{itemize}
	\item systemet inte uppför sig som man tror.
	\item man har begränsningar i styrförmåga.
	\item man får instabilitet på grund av återkopplingen.
\end{itemize}

Det är även ett problem att om felet är stationärt, är även styrsignalen det, så även om du har ett nollskild fel klarar inte systemet nödvändigtvis anpassa sig.

\paragraph{PID-reglering}
PID står för proportionell integrerande deriverande. Denna sortens reglering löser många reglerproblem. Med PID-reglering väljer vi styrsignlaen
\begin{align*}
	u = K_{\text{P}}e + K_{\text{I}}\integ{t_{0}}{t}{\tau}{e} + K_{\text{D}}\dv{e}{t}.
\end{align*}
Alternativt kan vi skriva det som
\begin{align*}
	u = K\left(e + \frac{1}{T_{\text{I}}}\integ{t_{0}}{t}{\tau}{e} + T_{\text{D}}\dv{e}{t}\right).
\end{align*}

De tre ingående termerna i styrsignalen är
\begin{itemize}
	\item proportionell återkoppling, som betraktar det nuvarande felet.
	\item integrerande återkoppling, som betraktar hur felet har uppfört sig.
	\item deriverande återkoppling, som betraktar hur felet kommer att uppföra sig.
\end{itemize}

\paragraph{PI-reglering}
PI-reglering använder ej den deriverande återkopplingstermen. Vi ser härifrån att vid ett stationärt tillstånd är antingen $e = 0$, annars ökar eller minskar $u$ på grund av integraltermen.

Vi vill nu betrakta systemets insvängning. Om det stationära $\bar{u}$ krävs för att $e = 0$, har vi
\begin{align*}
	\bar{u} = K\left(e + \frac{1}{T_{\text{I}}}\integ{t_{0}}{t}{\tau}{e}\right).
\end{align*}
Vid att derivera detta fås
\begin{align*}
	K\left(\dv{e}{t} + \frac{1}{T_{\text{I}}}e\right) = 0,
\end{align*}
med lösning proportionell mot $e^{-\frac{t}{T_{\text{I}}}}$.

Notera att om man har stort fel kan PI-reglering ge problem. Därför använder man det typiskt när felen är små.

\paragraph{PI-reglering i Laplacevärlden}
Vid att Laplacetransformera uttrycket för styrsignalen i en PI-regulator, nämligen
\begin{align*}
	u = K\left(e + \frac{1}{T_{\text{I}}}\integ{t_{0}}{t}{\tau}{e}\right),
\end{align*}
fås
\begin{align*}
	U = K\left(E + \frac{1}{T_{\text{I}}s}E\right),
\end{align*}
och enligt figur \ref{fig:negative_feedback} ser vi att
\begin{align*}
	F(s) = K\left(1 + \frac{1}{T_{\text{I}}s}\right).
\end{align*}

\paragraph{Rotort}
Betrakta ett system med överförningsfunktion $G_{\text{O}}$ för det öppna systemet. Det slutna systemet kommer ha överförningsfunktion
\begin{align*}
	G_{\text{C}} = \frac{G_{\text{O}}}{1 + G_{\text{O}}}.
\end{align*}
$G_{\text{O}}$ är (tydligen) ofta på formen
\begin{align*}
	G_{\text{O}} = K\frac{Q}{P},
\end{align*}
där $K$ är en parameter. Då får vi
\begin{align*}
	G_{\text{C}} = \frac{KQ}{P + KQ}.
\end{align*}
Systemet har alltså poler som ges av
\begin{align*}
	P + KQ = 0,\ \frac{P}{Q} = -K.
\end{align*}
Detta kriteriet anger systemets rotort.

Vi antar nu att $P$ och $Q$ är polynom av grad $n$ respektiva $m$, där $n \geq m$. Då vet vi att kriteriet har $n$ rötter, och rotorten har därför $n$ grenar. Rötterna dyker antingen upp som reellvärda eller i par av komplexkonjugerade rötter, och därmed är rotorten symmetrisk med avseende på reella axeln. Vi vet även att rotorten har $n - m$ asymptoter. Det gäller även att alla delar av reella axeln som har ett udda antal reella start- och ändpunkter till höger om sig tillhör rotorten.

För att rita rotorten kan du följa dessa steg:

\begin{itemize}
	\item Beräkna överförningsfunktionen för det slutna systemet. Skriv nämnaren som $P + KQ = 0$.
	\item Hitta startpunkterna, alltså rötterna till $P$.
	\item Hitta ändpunkterna, alltså rötterna till $Q$.
	\item Bestäm antal asymptoter, alltså gradtalet till $P$ minus gradtalet till $Q$.
	\item Beräkna punkterna där rotorten korsar reella axeln, altså en dubbelrot till karakteristiska ekvationen.
	\item Bestäm deras riktningar genom att betrakta argumentet till $\frac{P}{Q} = -K$ för stora $s$.
	\item Bestäm korsningar med imaginära axeln genom att sätta $s = i\omega$. Kom ihåg att $K\geq 0$.
	\item Bestäm vilka delar av reella axeln som tillhör rotorten. Det är de delar som har ett udda antar start- och slutpunkter till höger om sig.
	\item Rita.
\end{itemize}

\paragraph{Nyquistkriteriet}
Givet överförningsfunktionen
\begin{align*}
	G_{\text{C}} = \frac{G_{\text{O}}}{1 + G_{\text{O}}}.
\end{align*}
för ett slutet system, finns det några poler så att systemet är instabilt? En ide för att undersöka detta är att undersöka alla $s$ i högre halvplan och se vilka värden på $G_{\text{O}}$ man får. Detta gör vi genom att rita två halvcirklar med radier $r$ respektivar $R$ i högre halvplan, förbinda dem med raka linjer i änderna och låta $r$ gå mot $0$ och $R$ mot $\infty$. $G_{\text{O}}$ kommer då anta värden på en kurva som kallas för Nyquistkurvan. Argumentvariationsprincipen från komplex analys ger oss då att antalet poler i höger halvplan till ett återkopplad system är lika med antalet poler i höger halvplan hos $G_{\text{O}}$ plus antalet varv som Nyquistkurvan omsluter punkten $-1$. Speciellt, om $G_{\text{O}}$ inte har poler i höger halvplan, är systemet stabilt om Nyquistkurvan inte omsluter $-1$.

Av någon anledning är den viktigaste delen där $\gamma'$ skär imaginära axeln. Man ska även kunna observera att $G_{\text{O}}(\infty) = 0$ och $G_{\text{O}}(0)\approx\frac{K}{s^{p}}$, där $p$ är antal poler i origo.

\paragraph{Skärfrekvens}
Skärfrekvens $\omega_{\text{c}}$ är frekvensen för vilken Nyquistkurvan skär enhetscirkeln. Det är en tummregel att denna är ungefär lik bandbredden.

\paragraph{Fasmarginal}
Fasmarginalen $\phi_{\text{m}}$ är vinkeln mellan negativa $x$-axeln och punkten där Nyquistkurvan skär enhetscirkeln.

\paragraph{Phase-crossover-frekvens}
$\omega_{\text{p}}$ är frekvensen så att $\arg{G_{\text{O}}(i\omega_{\text{p}}} = -\pi$.

\paragraph{Amplitudmarginal}
Amplitudmarginalen ges av $A_{\text{m}} = \frac{1}{\abs{G_{\text{O}}(i\omega_{\text{p}}}}$.

\paragraph{Alternativt Nyquist-kriterium}
Nyquistkriteriet kan nu formuleras som $\phi_{\text{m}} > 0,\ A_{\text{m}} > 1$.